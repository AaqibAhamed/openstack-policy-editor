<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Patron策略在线编辑</title>
    <!-- Jquery 文件 -->
    <script type="text/javascript" src="jquery-3.1.1.min.js"></script>
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="bootstrap.min.css">
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="bootstrap.min.js"></script>
    <script src="dropdowns-enhancement.js"></script>
    <link rel="stylesheet" href="dropdowns-enhancement.css">

    <link rel="stylesheet" href="patron.css">
    <script src="patron_parameters.js"></script>
    <script src="patron.js"></script>
    <style>
    </style>
    <script>
        /*
         1.从JS读取二维数组，第一层是name,第二层是action，同时要保证更改第一个下拉菜单的时候第二个跟着变。用了第三方的库dropdown-enhancement
         2.Value的话，前三个固定，第四部分需要从policy.json中除去带冒号的，剩下的key显示出来，内容显示在鼠标指上去的提示中。
         */
        //TODO 比如default，true or project***，context_is_admin，cells_scheduler_filter
        // .load()方法，已经废弃，现在用来执行ajax操作。只有.on()和.onload
        //$(document).ready()——网页中所有 DOM 结构绘制完毕后就执行，可能 DOM 元素关联的内容并没有加载完

        var current_json = new Object();
        var custom_rule = new Object(); //如果想给对象添加属性
        $(document).ready(function () {
            $("#name_menu").empty();
            //为name菜单初始化菜单项
            for (key in policy_array) {
                $("#name_menu").append('<li><input type="radio" id="' + key + '"name="menu1" value="' + key + '" onclick="afterFirstSelectorChanged($(this).val())"><label for="' + key + '">' + key + '</label></li>');   //为Select追加一个Option(下拉项)
            }
            //选中第一个元素
            $("#name_menu").find("li input").first().click();
            //name菜单加载后，设置action菜单
            $("#name_menu").on('load', afterFirstSelectorChanged($("#name_memu_btn").text().trim()));//加载之后设置action_menu
            //当点击自定义规则中的输入框时，切换radio button的选中
            $("#rule_value").focus(function(){
                $("#rule_radio_3").click();
            });
            $.getJSON("json/policy.json", function (data) {
                $.each(data, function (key, value) {//遍历属性
                    if (key.indexOf(":") < 0) {
                        //if (key.indexOf("context_is_admin") < 0) {
                            custom_rule[key] = value;//为规则赋值,必须用[]
                        //}
                    } else {
                        current_json[key] = value;
                    }
                });
                //接下来给 自定义Rule子菜单赋值 并绑定点击事件
                show_sub_rule_menu();

                //接下来给列表赋值 并绑定点击事件
                show_policy_list();

                //接下来给自定义规则的列表赋值 并绑定点击事件
                show_rule_list();
            });

        });
    </script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-lg-10 col-lg-offset-1">
            <h3>
                <span class="label label-primary">Name</span>
                <div class="btn-group">
                    <button data-toggle="dropdown" class="btn btn-default dropdown-toggle" id="name_memu_btn">Option1
                        <span class="caret"></span></button>
                    <ul class="dropdown-menu" id="name_menu">
                    </ul>
                </div>

                <span class="label label-primary marginLeft">Action</span>
                <div class="btn-group">
                    <button data-toggle="dropdown" class="btn btn-default dropdown-toggle" id="action_memu_btn">Option1
                        <span class="caret"></span></button>
                    <ul class="dropdown-menu custom-menu-scroll" id="action_menu">
                        //这里的scrollable设置一个350高的滚动条，也可以用pre-scrollable
                    </ul>
                </div>

                <span class="label label-primary  marginLeft">Value</span>
                <span class="btn-group">
                    <button data-toggle="dropdown" class="btn btn-default dropdown-toggle"
                            id="value_memu_btn">空<span class="caret"></span></button>
                    <ul class="dropdown-menu" id="value_menu">
                        <li><a onclick="afterThirdSelectorClicked($(this).text())">空</a></li>
                        <li class="divider"></li>
                        <li><a onclick="afterThirdSelectorClicked($(this).text())">is_admin:True</a></li>
                        <li><a onclick="afterThirdSelectorClicked($(this).text())">is_admin:False</a></li>
                        <li class="divider"></li>
                        <li class="dropdown-submenu" id="value_sub_li"><a data-toggle="dropdown">自定义Rule</a>
                            <ul class="dropdown-menu" id="value_sub_menu">
                            </ul>
                        </li>
                    </ul>
                </span>

                <span class="marginLeft"><button type="button" class="btn btn-success"
                                                 onclick="save_this_policy()">保存</button></span>
            </h3>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-10 col-lg-offset-1">
            <ul class="list-group custom-list-scroll" id="policy-list-group">
            </ul>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-10 col-lg-offset-1">
            <h4>
                <form class="form-inline">
                    <span class="label label-primary">Name</span>
                    <input type="text" class="form-control input-width" id="rule_name" placeholder="规则名">

                    <span class="label label-primary marginLeftSmall">Rule</span>
                    <!--用inline可以控制行内显示-->
                    <label class="small-text radio inline"><input type="radio" name="rule_radio" id="rule_radio_1"
                                                                  value="rule_radio_1" checked>is_admin:True</label>
                    <label class="small-text radio inline"><input type="radio" name="rule_radio" id="rule_radio_2"
                                                                  value="rule_radio_2">is_admin:False</label>
                    <label class="small-text radio inline"><input type="radio" name="rule_radio" id="rule_radio_3"
                                                                  value="rule_radio_3"></label>
                    <input type="text" class="form-control input-width" id="rule_value" placeholder="自定义">
                    <button type="button" class="btn btn-success marginLeftSmall" onclick="save_this_rule()">保存</button>
                </form>
            </h4>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-10 col-lg-offset-1">
            <ul class="list-group custom-list-scroll" id="rule-list-group">
            </ul>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-2 col-lg-offset-5">
            <button type="button" class="btn btn-success marginLeftSmall" onclick="merge_rule_and_policy()">保存此文件</button>
        </div>
    </div>
</div>
</body>
</html>